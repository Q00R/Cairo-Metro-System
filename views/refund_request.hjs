<!DOCTYPE html>
<html>
  <head>
    <title>Courses</title>
    <link rel='stylesheet' href='/styles/bootstrap.min.css' />
    <link rel='stylesheet' href='/styles/style.css' />
    <script src="/js/jquery-2.2.0.min.js" type="text/javascript"></script>
    <script src="/js/bootstrap.min.js" type="text/javascript"></script>
  </head>
  <body>
  <script>
      $(document).ready(function(){
        $("#submit").click(function() {
          const ticketId = $('#myDropdown').val();
          if(ticketId == null || ticketId == -1 || ticketId == undefined || isNaN(ticketId)) {
            alert('Please select a ticket');
            window.location.href = '/requests/refund'; 
          }
          else{
            const url = `/api/v1/refund/${ticketId}`;
            $.ajax({
              type: "POST",
              url,

              success: function(serverResponse) {
                if(serverResponse) {
                  alert('Ticket refund request submitted successfully' + serverResponse.responseText);
                }
              },
              error: function(errorResponse) {
                if(errorResponse) {
                  alert(`Something went wrong: ${errorResponse.responseText}`);
                }            
              }
            });
          }
        });
        });
      </script>    
    <div>
      <div>
        <nav class="navbar navbar-inverse" style="padding-left:2%;">
          <ul class="nav navbar-nav">
            <li class="active"><a href="/dashboard">Home</a></li>
            {{#isAdmin}}
              <li><a href="/manage/stations">Station</a></li>
              <li><a href="/manage/zones">Zones</a></li>
              <li><a href="/manage/routes">Routes</a></li>
              <div class="dropdown navbar navbar-inverse nav navbar-nav">
                <li><a>Requests</a></li>
                <div class="dropdown-content navbar navbar-inverse nav navbar-nav">
                <li><a href="/manage/requests/seniors">Senior</a></li>
                <li><a href="/manage/requests/refunds">Refund</a></li>
                </div>
              </div>
            {{/isAdmin}}
            {{#isNormal}}
              <li><a href="/subscriptions">Subscriptions</a></li>
              <li><a href="/requests/refund">Refund Ticket</a></li>
              <li><a href="/requests/senior">Senior Citizens</a></li>
              <li><a href="/price">Ticket Price</a></li>
              <li><a href="/tickets">Book a ticket</a></li>
            {{/isNormal}}
          </ul>
          <ul class="nav navbar-nav navbar-right" style="padding-right:2%">
            <li><a style="color:goldenrod" href="/resetPassword">Reset Password</a></li>
            <li><a  style="color:crimson" href="/">Logout</a></li>
          </ul>
       </nav>
      </div>

      <div style="margin-left: auto; margin-right: auto; padding-bottom: 5%;">
        <h1 style="text-align: center;">Apply For Refund Requests</h1>
      </div>
        
        <form id="myForm" method="post">
          
        <div class="dropdown" style="margin-left: auto; margin-right: auto; padding-left: 35%;">
            <select id="myDropdown" style="width: 50%;" class="btn btn-secondary btn-lg dropdown-toggle">
                <option disabled selected value="-1">Select a ticket</option>
                {{#userTickets}}
                    <option value={{id}}>{{id}}</option>                    
                {{/userTickets}}
            </select>
        <input id="submit" style="width: 45%; height: 40%" class="btn btn-warning" name="submit" type="button" value="Place Request"><br><br>
        </form>
        </div>
        <div style="margin-left: auto; margin-right: auto; padding-left: 35%;">
        <img src="/ref2.jpg" style="width:45%" alt="refund"><br>
        </div>
    <div class="form-group form-horizontal">
        {{#hasNoTickets}}
          <tr>
            <div class="alert alert-danger">
              <strong>Warning!</strong> You have no Tickets.
            </div>
          </tr>
        {{/hasNoTickets}}
        {{^hasNoTickets}}
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Id</th>
              <th>Origin</th>
              <th>Destination</th>
              <th>User Id</th>
              <th>Subscription Id</th>
              <th>Trip Date</th>
            </tr>
          </thead>
          {{#userTickets}}
          <tbody>
            <tr>
              <td>{{id}}</td>
              <td>{{origin}}</td>
              <td>{{destination}}</td>
              <td>{{userId}}</td>
              <td>{{subId}}</td>
              <td>{{tripDate}}</td>
            </tr>
          {{/userTickets}}
        </table>
        {{/hasNoTickets}}
    </div>
        
    </div>
  </body>
  </html>
